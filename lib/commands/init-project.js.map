{"version":3,"sources":["../../src/commands/init-project.js"],"names":["isObject","item","Array","isArray","mergeDeep","target","sources","length","source","shift","key","Object","assign","program","version","option","parse","process","argv","args","projectName","templateName","templateDirectory","path","join","__dirname","projectDirectory","cwd","readmeFile","packageJsonFile","mainFile","testFile","existingPackageJson","existingReadme","existingMain","existingTest","Error","console","log","fs","readFile","catch","then","test","main","readme","readJson","json","copy","packageJson","newPackageJson","name","writeJson","writeFile","childProcess","exec"],"mappings":"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","sourcesContent":["import fs from \"fs-extra\";\nimport path from \"path\";\nimport childProcess from \"child-process-es6-promise\";\n\nfunction isObject(item) {\n    return (item && typeof item === 'object' && !Array.isArray(item));\n}\n\nfunction mergeDeep(target, ...sources) {\n    if (!sources.length) {\n        return target;\n    }\n\n    const source = sources.shift();\n\n    if (isObject(target) && isObject(source)) {\n        for (const key in source) {\n            if (isObject(source[key])) {\n                if (!target[key]) Object.assign(target, { [key]: {} });\n                mergeDeep(target[key], source[key]);\n            } else {\n                Object.assign(target, { [key]: source[key] });\n            }\n        }\n    }\n\n    return mergeDeep(target, ...sources);\n}\n\nexport default (program) => {\n\n    program.version(\"0.0.1\")\n        .option(\"-t, --type [type]\", \"Type of project. Options are: 'babel' (default), 'system' (dispatcher system).\")\n        .parse(process.argv);\n\n    var args = program.args;\n    var projectName = args[1] || \"\";\n    var templateName = \"init-project-template\";\n\n    var templateDirectory = path.join(__dirname, \"../../templates/\", templateName);\n    var projectDirectory = process.cwd();\n    var readmeFile = path.join(projectDirectory, \"README.md\");\n    var packageJsonFile = path.join(projectDirectory, \"package.json\");\n    var mainFile = path.join(projectDirectory, \"src/index.js\");\n    var testFile = path.join(projectDirectory, \"src/tests/example.js\");\n    var existingPackageJson = null;\n    var existingReadme = null;\n    var existingMain = null;\n    var existingTest = null;\n\n    if (projectName == null) {\n        throw new Error(\"Please provide a project name.\");\n    }\n\n    console.log(\"Creating template....\");\n    console.log(\"Checking for existing 'src/tests/example.js' file.\");\n\n    fs.readFile(testFile).catch(() => {\n\n        console.log(\"No 'tests/example.js' found.\");\n        return null;\n\n    }).then((test) => {\n\n        existingTest = test;\n        console.log(\"Checking for existing 'src/index.js' file.\");\n        return fs.readFile(mainFile)\n\n    }).catch(() => {\n\n        console.log(\"No 'src/index.js' found.\");\n        return null;\n\n    }).then((main) => {\n\n        console.log(\"Checking for existing README.md file.\");\n        existingMain = main;\n        return fs.readFile(readmeFile);\n\n    }).catch(() => {\n\n        console.log(\"No README.md file found.\");\n        return null;\n\n    }).then((readme) => {\n\n        existingReadme = readme;\n\n        if (readme == null) {\n            console.log(\"Found README.md file.\");\n        }\n\n        console.log(\"Checking for existing package.json.\");\n        return fs.readJson(packageJsonFile);\n\n    }).catch(() => {\n\n        console.log(\"No package.json file found.\");\n        return {};\n\n    }).then((json) => {\n\n        existingPackageJson = json;\n        return fs.copy(templateDirectory, projectDirectory);\n\n    }).then(() => {\n\n        console.log(\"Modifying package.json...\");\n\n        return fs.readJson(packageJsonFile);\n\n    }).then((packageJson) => {\n\n        var newPackageJson = mergeDeep({ name: projectName }, packageJson, existingPackageJson);\n\n        console.log(\"Saving package.json...\");\n        return fs.writeJson(packageJsonFile, newPackageJson);\n\n    }).then(() => {\n\n        console.log(\"Saved package.json.\");\n\n        if (existingReadme != null) {\n            console.log(\"Saving README.md file.\");\n            return fs.writeFile(readmeFile, existingReadme);\n        }\n\n    }).then(() => {\n\n        console.log(\"Saved README.md.\");\n\n        if (existingMain != null) {\n            console.log(\"Saving 'src/index.js'.\");\n            return fs.writeFile(mainFile, existingMain);\n        }\n\n    }).then(() => {\n\n        console.log(\"Saved 'src/index.js'.\");\n        if (existingTest != null) {\n            console.log(\"Saving 'src/tests/example.js\");\n            return fs.writeFile(testFile, existingTest);\n        }\n\n    }).then(() => {\n\n        console.log(\"Saved 'src/tests/example.js'.\");\n        console.log(\"Running npm for you, this may take a while...\");\n\n        return childProcess.exec(\"npm install\", { cwd: projectDirectory });\n\n    }).then(() => {\n\n        console.log(\"Locked and loaded, you are ready to go. Happy coding.\");\n\n    });\n\n}\n"],"file":"init-project.js"}